<h2>ElasticSearch简介</h2>
你知道，搜索（和分析）

ElasticSearch是位于elastic堆栈中心的分布式搜索和分析引擎。logstash和beats有助于收集、聚合和丰富数据，并将其存储在ElasticSearch中。Kibana使您能够交互地探索、可视化和共享对数据的洞察，并管理和监控堆栈。ElasticSearch是索引、搜索和分析的神奇之处。

ElasticSearch为所有类型的数据提供实时搜索和分析。无论您有结构化或非结构化的文本、数字数据或地理空间数据，ElasticSearch都可以以支持快速搜索的方式高效地存储和索引它。您可以超越简单的数据检索和聚合信息，发现数据中的趋势和模式。随着数据和查询量的增长，ElasticSearch的分布式特性使您的部署能够与之无缝地增长。

虽然并非每个问题都是搜索问题，但ElasticSearch提供了在各种用例中处理数据的速度和灵活性：

*向应用程序或网站添加搜索框  
*存储和分析日志、指标和安全事件数据  
*使用机器学习实时自动模拟数据的行为  
*使用ElasticSearch作为存储引擎自动化业务工作流  
*使用ElasticSearch作为地理信息系统（GIS）管理、集成和分析空间信息  
*使用弹性搜索作为生物信息学研究工具存储和处理遗传数据  

我们一直对人们使用搜索的新奇方式感到惊讶。但是，无论您的用例与其中一个类似，还是您使用ElasticSearch来解决一个新问题，您在ElasticSearch中处理数据、文档和索引的方式都是相同的。

<h3>Information out: search and analyze</h3>

虽然您可以将ElasticSearch用作文档存储并检索文档及其元数据，但真正的优势在于能够轻松访问构建在ApacheLucene搜索引擎库上的整套搜索功能。

ElasticSearch提供了一个简单、一致的RESTAPI，用于管理集群、索引和搜索数据。出于测试目的，您可以直接从命令行或通过Kibana中的开发人员控制台轻松提交请求。从您的应用程序中，您可以使用ActudiSql客户端来选择您的语言：Java、JavaScript、GO、.NET、PHP、Perl、Python或Ruby。

<h3>Searching your data</h3>

ElasticSearchRESTAPI支持结构化查询、全文查询和将两者结合在一起的复杂查询。结构化查询与您可以在SQL中构造的查询类型类似。例如，您可以搜索员工索引中的性别和年龄字段，并按雇用日期字段对匹配项进行排序。全文查询查找与查询字符串匹配的所有文档，并返回按相关性排序的文档，它们与搜索词的匹配程度如何。

除了搜索单个术语之外，还可以执行短语搜索、相似性搜索和前缀搜索，并获取自动完成建议。

是否有要搜索的地理空间数据或其他数字数据？ElasticSearch在支持高性能地理和数字查询的优化数据结构中索引非文本数据。

您可以使用ElasticSearch的综合JSON风格查询语言（查询DSL）访问所有这些搜索功能。您还可以构造SQL样式的查询，以在elasticsearch中本机搜索和聚合数据，JDBC和ODBC驱动程序使广泛的第三方应用程序能够通过SQL与elasticsearch交互。

<h3>Analyzing your data</h3>

ElasticSearch聚合使您能够构建复杂的数据摘要，并深入了解关键指标、模式和趋势。聚合使您能够回答以下问题，而不仅仅是找到谚语中的“大海捞针”。

*干草堆里有多少针？  
*针的平均长度是多少？  
*针的中间长度是多少，由制造商细分？  
*在过去的六个月里，干草堆里每加了多少针？  

您还可以使用聚合来回答更微妙的问题，例如：

*你们最受欢迎的针制造商是什么？  
*是否有异常或异常的针团？  

因为聚合利用用于搜索的相同数据结构，所以它们也非常快。这使您能够实时分析和可视化数据。您的报表和仪表板会随着数据的更改而更新，因此您可以根据最新信息采取操作。

此外，聚合与搜索请求一起运行。您可以在单个请求中同时对同一数据搜索文档、筛选结果和执行分析。而且，由于聚合是在特定搜索的上下文中计算的，因此您不仅显示所有70号针的数量，还显示符合用户搜索标准的70号针的数量，例如，所有70号不粘刺绣针。

<h3>But wait, there’s more</h3>

想要自动分析时间序列数据吗？您可以使用机器学习功能来创建数据中正常行为的精确基线，并识别异常模式。通过机器学习，您可以检测到：

*与数值、计数或频率的时间偏差有关的异常  
*统计稀有性  
*一个群体成员的异常行为  

最好的部分呢？您可以这样做，而无需指定算法、模型或其他与数据科学相关的配置。

<h3>Scalability and resilience: clusters, nodes, and shards</h3>

ElasticSearch可随时使用，并可根据您的需要进行扩展。它是通过自然的分配来实现的。您可以将服务器（节点）添加到集群以增加容量，ElasticSearch会自动将数据和查询负载分布到所有可用节点上。ElasticSearch不需要彻底检查您的应用程序，它知道如何平衡多节点集群以提供规模和高可用性。节点越多，越快乐。

这是怎么工作的？在封面下，弹性搜索索引实际上只是一个或多个物理碎片的逻辑分组，其中每个碎片实际上是一个独立的索引。通过将索引中的文档分布在多个碎片上，并将这些碎片分布在多个节点上，ElasticSearch可以确保冗余，这既可以防止硬件故障，也可以随着节点添加到集群中而增加查询容量。随着集群的增长（或缩小），ElasticSearch会自动迁移碎片以重新平衡集群。

有两种类型的碎片：初级和复制品。索引中的每个文档都属于一个主碎片。副本碎片是主碎片的副本。副本提供数据的冗余副本，以防止硬件故障，并增加服务于读取请求（如搜索或检索文档）的容量。

索引中主碎片的数量在创建索引时是固定的，但是副本碎片的数量可以随时更改，而不会中断索引或查询操作。

<h3>It depends…</h3>

对于一个索引配置的切分大小和主切分的数量，有许多性能考虑因素和权衡因素。碎片越多，维护这些索引的开销就越大。碎片大小越大，当ElasticSearch需要重新平衡集群时，移动碎片所需的时间就越长。

查询大量的小碎片可以加快每个碎片的处理速度，但是更多的查询意味着更多的开销，因此查询较小数量的较大碎片可能更快。简而言之……视情况而定。

作为起点：

*目标是将平均碎片大小保持在几GB到几十GB之间。对于基于时间的数据的用例，通常可以看到20GB到40GB范围内的碎片。  
*避免目不转睛的碎片问题。节点可以容纳的碎片数量与可用堆空间成比例。一般来说，每GB堆空间中的碎片数应该小于20。  

确定用例最佳配置的最佳方法是通过使用自己的数据和查询进行测试。

<h3>In case of disaster</h3>

出于性能原因，集群中的节点需要位于同一网络上。在不同数据中心的节点之间平衡集群中的碎片只需要太长时间。但是高可用性体系结构要求您避免将所有鸡蛋放在一个篮子中。在一个位置发生重大故障时，另一个位置的服务器需要能够接管。无缝连接。答案是什么？跨群集复制（CCR）。

CCR提供了一种方法，可以自动将索引从主集群同步到可充当热备份的辅助远程集群。如果主集群出现故障，则辅助集群可以接管。您还可以使用CCR创建辅助集群，以在地理位置接近您的用户的情况下为读取请求提供服务。

跨群集复制是主动-被动的。主集群上的索引是活动的前导索引，处理所有写请求。复制到次要群集的索引是只读的关注者。

<h3>Care and feeding</h3>

与任何企业系统一样，您需要工具来保护、管理和监控您的ElasticSearch集群。集成到ElasticSearch中的安全、监视和管理功能使您能够使用Kibana作为管理集群的控制中心。数据汇总和索引生命周期管理等功能可帮助您随着时间的推移智能地管理数据。

